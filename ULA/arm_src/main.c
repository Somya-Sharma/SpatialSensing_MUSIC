
#include "lib_xmusic_hw.h"
#include "xparameters.h"
#include "platform.h"
#include "xaxidma.h"
#include <stdbool.h>
#include <stdlib.h>
#include "sdCard.h"
#include <stdio.h>
#include "pcap.h"

//Size of BIN file to be read from the SD Card
//make sure that this value matches with the size of binfiles generated
#define PR_BIT_STREAM_SIZE	 1246452
char bitStreamBuffer[PR_BIT_STREAM_SIZE];

// AXI DMA Instance
XAxiDma AxiDma;

//Initialize the DMA
int init_dma()
{
	XAxiDma_Config *CfgPtr;
	int status;

//Extract the DMA configuration parameters
	CfgPtr = XAxiDma_LookupConfig( (XPAR_AXI_DMA_0_DEVICE_ID) );
	if(!CfgPtr)
	{
		xil_printf("Error looking for AXI DMA config\n\r");
		return XST_FAILURE;
	}

//Initialize the DMA configuration parameters to the DMA instance
	status = XAxiDma_CfgInitialize(&AxiDma,CfgPtr);
	if(status != XST_SUCCESS)
	{
		xil_printf("Error initializing DMA\n\r");
		return XST_FAILURE;
	}

//check for scatter gather mode
	if(XAxiDma_HasSg(&AxiDma))
	{
		xil_printf("Error DMA configured in SG mode\n\r");
		return XST_FAILURE;
	}

/* Disable interrupts, we use polling mode */
	XAxiDma_IntrDisable(&AxiDma, XAXIDMA_IRQ_ALL_MASK, XAXIDMA_DEVICE_TO_DMA);
	XAxiDma_IntrDisable(&AxiDma, XAXIDMA_IRQ_ALL_MASK, XAXIDMA_DMA_TO_DEVICE);

// Reset DMA
	XAxiDma_Reset(&AxiDma);
	while (!XAxiDma_ResetIsDone(&AxiDma)) {}
	return XST_SUCCESS;
}


int main(int argc, char **argv)
{
	int j;
	int status;

	int res_hw1[1];		//output for DoA=1
	int res_hw2[2];		//output for DoA=2

//Device Configuration instance to access the BIN file via PCAP port
	XDcfg DcfgInstance;

	unsigned int dma_size1 = SIZE1 * sizeof(float);		//size of input signal matrix in bytes
	unsigned int dma_size2 = SIZE2 * sizeof(float);		//size of input sensing matrix in bytes

	init_platform();

	xil_printf("\r\n\n***************************************************************\n\r");
	xil_printf("\rFP MUSIC ALGO ON ULA -> AXI DMA -> ARM ACP                     \n\r");
	xil_printf("\rdesigned with Vivado + HLS + IP Integrator 2019.3.1 \n\r");
	xil_printf("\r***************************************************************\n\n\r");


	/* ******************************************************************************* */
// Init DMA
	status = init_dma();
	if(status != XST_SUCCESS)
	{
		xil_printf("\rError: DMA init failed\n");
		return XST_FAILURE;
	}
	xil_printf("\r\nDMA Init done\r");

//Init PCAP port
	status = initPCAP(XPAR_XDCFG_0_DEVICE_ID,&DcfgInstance);
	if (status != XST_SUCCESS)
	{
		print("PCAP init failed!!\n\r");
		return XST_FAILURE;
	}
	xil_printf("\r\nPCAP Init done\r");

//Init SD Card
	status = SD_Init();
	if (status != XST_SUCCESS)
	{
	   print("file system init failed!!\n\r");
	   return XST_FAILURE;
	}
	xil_printf("\r\nSD Init done\r");

//Initialize input matrices separately for real and imaginary part
	float X_real [L][K] = {{-1.147999, -1.226142, -0.869029, 0.6004, -1.114016, -3.130243, -0.960744, 1.48626, -3.439604, -0.588225, -4.046376, 1.151099, -3.001216, 1.521763, 2.559101, -0.969522, 1.304724, 0.366665, 1.309723, -0.751857, -0.53232, 0.947743, 1.65212, -3.332576, -1.11067, 1.437313, -0.527712, 1.376843, -0.917971, 2.590828, -1.395183, -1.222426, 0.982038, 0.594, -2.712812, 1.177999, -3.329175, -0.558898, 0.76111, 1.336126, 0.959432, 0.364743, -3.192086, -1.519114, -0.819713, -0.952903, -3.219329, -0.592934, 3.526722, -1.322214, -0.244666, -1.134114, -0.884651, -2.988148, -2.894495, 1.186314, 3.042954, 0.437866, 1.897932, -1.30296, -2.459364, -1.749972, 1.433618, 1.324369, 1.117528, 3.094933, 2.575884, 1.296324, 3.187357, -0.310195, -1.237514, 1.4114, 1.20706, 1.78542, 2.736706, -2.180655, 0.891587, -0.992597, 0.696685, 3.435012, 1.269035, 3.761319, 1.05869, -0.940565, 0.598302, 0.960659, 0.93147, 1.088281, -1.326918, -1.25851, 1.386336, -0.978255, 1.156215, -0.797627, -1.189556, -3.181981, -1.191388, 1.644895, -0.273442, 1.166039}, {-1.567769, -1.545466, -0.081389, -1.410972, -2.136237, -0.42409, -1.831589, 1.93823, -0.213664, 0.262495, -0.000501, -1.157485, -0.074083, -1.887361, -0.322703, -0.126307, -1.513825, -2.098119, 2.146193, 1.601867, -1.215107, 1.040556, 1.78368, 0.15318, -1.000466, -0.122301, 1.436098, 2.059685, -1.886651, 0.001673, -0.533566, -1.30498, 2.299527, 2.0127, 0.112898, 0.017953, 0.194141, -1.52341, 1.458491, 1.667486, 1.763945, 0.318485, 0.750838, 1.602094, 1.55205, -2.176259, 0.323299, -0.04301, 0.241961, 0.023352, -1.626301, 1.144903, -1.637366, -0.23113, 0.130113, -1.571128, -0.225874, -1.54351, -2.450084, 0.77159, -0.301567, -1.542943, -1.506552, 2.514388, -0.203066, 0.266377, -0.385868, 1.626762, -0.264616, 1.353929, 0.090106, 2.211685, 0.269834, -2.022906, -0.188551, -0.017406, 0.29271, -1.994729, -2.090095, 0.051343, -0.595442, -0.568401, -0.102876, 0.199746, -0.282707, 0.303944, 0.380332, -0.230748, -1.570838, -1.72343, 1.034753, 0.200537, -1.931707, -0.341268, 1.226418, 0.230667, -0.077361, -1.481031, -0.310956, -1.346944}, {0.828075, 1.050705, -2.777337, -0.736933, 0.777035, -0.260951, 1.107689, -0.907301, -0.209745, -2.716759, -0.484074, -0.805691, -0.393564, -0.803514, 0.753009, -2.081802, -0.734055, -0.191172, -0.928021, 1.373955, 1.137909, -0.568574, -0.621553, 0.242793, 1.296687, 1.792863, 0.754329, -1.184607, 1.580962, -0.01693, -2.140739, 1.424319, -1.000651, -1.333791, 0.250265, 1.467642, 0.335578, 0.598957, -1.220602, -1.385298, -1.255818, 2.055851, -0.267993, 1.024809, 0.66003, 1.522258, -0.906766, -2.018698, 0.506342, -2.293131, 1.311863, 1.398563, 0.801817, 0.003077, -0.252785, -0.51476, 0.225019, -0.479576, -0.971896, -2.208867, 0.261166, 1.412702, -0.647467, -0.908027, 2.70281, 0.04553, 0.025647, -1.216143, 0.288133, 1.390628, -2.795439, -1.30976, 2.071902, -0.689175, 0.372971, -0.145763, 2.005132, 1.48957, -1.59965, 0.179596, 1.817422, 0.272226, 2.001519, -2.440539, 2.161227, 2.024132, 1.608781, 1.856607, 1.021228, 1.290938, -0.832108, -2.131068, 0.177759, -2.353797, 1.168911, -0.150496, -2.107162, -0.495612, -2.210688, -0.722856}, {-0.171066, -0.182253, 0.655011, -0.532555, -0.06931, 0.435603, -0.601345, -0.038995, -0.014327, -0.163361, 0.462778, -0.071332, -0.093752, 0.150193, -0.471928, 0.319479, 0.005287, 0.110335, 0.608407, 0.632065, -0.246471, 0.493395, 0.434619, 0.755248, -0.55893, -0.501232, 0.289351, -0.107022, 0.040395, -0.491782, 0.107132, 0.291475, 0.217338, -0.116483, 0.105128, -0.218253, 0.101555, -0.457362, 0.641448, 0.619802, 0.228522, -0.643163, 0.463622, 0.27033, 0.310363, 0.924677, 0.635694, 0.522474, -0.389245, 0.536331, -0.143998, 0.048393, 0.121752, -0.120286, 0.017454, -0.046944, -0.459225, -0.143019, -0.272867, 0.65966, 0.788844, -0.723909, -0.319937, 0.231483, -0.128736, -0.28817, -1.055713, 0.188528, -0.235385, -0.265799, -0.306817, -0.245991, -0.160451, 0.836376, -0.02264, 0.357619, -0.490733, -0.047808, -0.083348, -0.327127, -0.157499, -0.203581, -0.248797, -0.155479, -0.693286, -0.203612, 0.308325, -0.386332, -0.248865, -0.356078, 0.988419, -0.047274, -0.62068, 0.388515, 0.584166, 0.383354, 0.430774, -0.714846, 0.212417, -0.603006}};
	float X_imag [L][K] = {{0.164814, 0.019421, 0.039926, -0.040622, 0.235615, 0.294367, 0.200591, -0.067761, -0.316325, 0.227964, 0.064443, -0.384177, 0.158537, 0.106265, -0.74581, -0.038058, 0.208776, -0.282441, -0.103367, 0.551462, -0.590278, 0.133503, -0.368443, -0.530529, 0.356152, -0.248431, -0.164628, -0.361378, 0.524217, -0.030901, -0.378079, -0.407022, 0.426426, 0.131596, 0.40241, -0.323665, -0.001171, -0.098072, 0.48861, -0.25761, -0.237608, 0.035162, -0.490699, -0.105361, 0.17618, 0.338606, 0.054179, 0.382448, 0.555923, 0.447183, -0.113528, -0.884748, -0.601022, 0.533424, -0.022665, -0.537368, 0.330412, -0.706203, 0.45986, -0.186201, -0.303726, 0.015642, -0.69191, -0.148569, -0.17401, 0.243351, -0.171394, -0.400594, 0.399249, -0.005477, 0.379559, 0.070631, -0.215113, -0.031859, -0.104458, 0.808049, 0.308062, 0.507923, -0.165454, 0.306073, -0.121969, 0.102144, -0.104387, -0.547628, 0.164996, -0.791844, 0.075741, -0.032767, -0.311367, -0.046514, 0.176846, -0.299742, -0.248821, -0.297359, -0.835648, 0.126299, -0.332839, 0.379069, -0.235745, -0.151515}, {0.925704, 0.849044, -2.393104, -0.844422, 0.801663, 0.273575, 0.748631, -0.471151, 0.892108, -2.047677, -0.680604, -0.876863, 0.238401, -0.816362, -0.999785, -2.143148, -0.966132, -1.329867, -0.497723, 1.091159, 0.822724, -0.599839, -1.095841, 0.708962, 0.57581, 2.707107, 0.879216, -1.102612, 1.381911, -0.363395, -1.587322, 0.984454, -0.362435, -0.941915, 0.112899, 1.692365, 0.26721, 1.810934, -0.736249, -0.923973, -0.932505, 2.106181, -0.040189, 1.016311, 0.904441, 0.800287, -0.50096, -2.1757, -0.819279, -1.64723, 0.85611, 1.604957, 1.281948, 0.549452, -0.101979, -1.048208, 0.00676, -1.033651, -1.664644, -2.125806, -0.185761, 0.990583, -1.115957, -1.054924, 1.800694, -0.156928, -0.521021, -0.97742, 0.095196, 2.341616, -1.976924, -1.280414, 1.622563, -0.439799, 0.264834, 0.812259, 1.489385, 0.688231, -1.451277, -0.00806, 1.862821, -0.072413, 1.886221, -2.356924, 1.907165, 1.00394, 1.850225, 3.025057, 0.942335, 1.220842, -0.985756, -2.393008, -1.384453, -2.222473, 1.093383, 0.185754, -2.305433, -1.09784, -2.574714, -0.13395}, {-1.03789, -1.210615, -0.504813, -1.144429, -1.261891, 0.081018, -1.797472, 2.140811, 0.148114, -0.129878, -0.565061, -1.716459, 0.431349, -1.708791, 0.490238, -0.413303, -1.863849, -1.521495, 1.599379, 0.991047, -1.627227, 1.043806, 1.844811, 0.32198, -1.741807, 0.100947, 2.014196, 1.512075, -1.785393, 0.256198, 0.134864, -1.621023, 1.293469, 1.091972, 0.533787, 0.493837, -0.204893, -1.404184, 1.950108, 2.21045, 1.365589, -0.183624, -0.418111, 2.032357, 1.350464, -1.772994, 0.07852, 0.12794, -0.014113, 0.065719, -1.485658, 1.560809, -2.202403, -0.237968, -0.381839, -2.170408, 0.022066, -1.591525, -1.362532, -0.301221, 0.109666, -2.144208, -2.148766, 1.347733, 0.507738, 0.273633, -0.099166, 2.083012, 0.156743, 2.019628, 0.406012, 1.384649, 0.093958, -1.719796, 0.492506, -0.217282, 0.099098, -1.971366, -1.634242, 0.354335, -0.14193, 0.591735, 0.385485, -0.010811, 0.669114, -0.223521, 0.397057, 0.254898, -1.422541, -1.646726, 1.887171, -0.326579, -1.556835, -0.600265, 1.660855, 0.365041, -0.330788, -1.634424, -0.23744, -1.641826}, {-0.853705, -0.771788, -0.996634, 1.175812, -0.606246, -3.43463, -0.694585, 1.444926, -2.980429, -0.904882, -2.738089, 1.363486, -2.768657, 1.49496, 3.325175, -1.461162, 1.122064, 0.898743, 1.019459, -0.469063, -1.044457, 1.419355, 1.019976, -3.147217, -1.021557, 0.92218, -0.901969, 0.84169, -1.96225, 2.516326, -0.735492, -1.65836, 0.934989, 1.277263, -3.370366, 1.656959, -3.453329, -1.199303, 0.442273, 1.077995, 1.158276, 1.418559, -2.638667, -1.098957, -0.975651, -0.83406, -3.003541, -1.375037, 3.099131, -0.537789, -1.534596, -0.800678, -0.879925, -2.608787, -3.673992, 0.731785, 3.086327, 0.337777, 0.832096, -1.344805, -3.394455, -0.504344, 0.96618, 1.168837, 1.383561, 2.675497, 2.594539, 0.879769, 2.863434, -0.706941, -0.741151, 0.99414, 1.84087, 0.979901, 3.031544, -2.490763, 1.236607, -1.592867, 0.794977, 2.53625, 0.893878, 2.698487, 1.097612, -0.816255, 1.203442, 1.240106, 1.546383, 1.159895, -1.318296, -0.754668, 0.753543, -0.799106, 0.762088, -0.742082, -0.665216, -3.541464, -1.400291, 1.066058, -0.983679, 0.779294}};
	float A_real [LL][181] = {{1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0}, {-1.0, -1.0, -0.999998, -0.999991, -0.999971, -0.999929, -0.999852, -0.999726, -0.999533, -0.999252, -0.998861, -0.998335, -0.997644, -0.99676, -0.995649, -0.994276, -0.992604, -0.990593, -0.988202, -0.985388, -0.982106, -0.978309, -0.973949, -0.968976, -0.963342, -0.956993, -0.949879, -0.941947, -0.933145, -0.923422, -0.912724, -0.901002, -0.888206, -0.874287, -0.859199, -0.842898, -0.825341, -0.80649, -0.786309, -0.764767, -0.741835, -0.717491, -0.691716, -0.664496, -0.635825, -0.6057, -0.574127, -0.541117, -0.506689, -0.470868, -0.433687, -0.395188, -0.355418, -0.314435, -0.272303, -0.229094, -0.18489, -0.139778, -0.093856, -0.047226, -0.0, 0.047704, 0.095761, 0.14404, 0.192405, 0.240714, 0.288821, 0.336576, 0.383825, 0.430413, 0.476183, 0.520976, 0.564635, 0.607003, 0.647924, 0.687247, 0.724822, 0.760506, 0.794159, 0.825649, 0.854851, 0.881648, 0.90593, 0.927599, 0.946564, 0.962748, 0.976083, 0.986514, 0.993996, 0.998497, 1.0, 0.998497, 0.993996, 0.986514, 0.976083, 0.962748, 0.946564, 0.927599, 0.90593, 0.881648, 0.854851, 0.825649, 0.794159, 0.760506, 0.724822, 0.687247, 0.647924, 0.607003, 0.564635, 0.520976, 0.476183, 0.430413, 0.383825, 0.336576, 0.288821, 0.240714, 0.192405, 0.14404, 0.095761, 0.047704, 0.0, -0.047226, -0.093856, -0.139778, -0.18489, -0.229094, -0.272303, -0.314435, -0.355418, -0.395188, -0.433687, -0.470868, -0.506689, -0.541117, -0.574127, -0.6057, -0.635825, -0.664496, -0.691716, -0.717491, -0.741835, -0.764767, -0.786309, -0.80649, -0.825341, -0.842898, -0.859199, -0.874287, -0.888206, -0.901002, -0.912724, -0.923422, -0.933145, -0.941947, -0.949879, -0.956993, -0.963342, -0.968976, -0.973949, -0.978309, -0.982106, -0.985388, -0.988202, -0.990593, -0.992604, -0.994276, -0.995649, -0.99676, -0.997644, -0.998335, -0.998861, -0.999252, -0.999533, -0.999726, -0.999852, -0.999929, -0.999971, -0.999991, -0.999998, -1.0, -1.0}, {1.0, 1.0, 0.999993, 0.999963, 0.999883, 0.999714, 0.999408, 0.998903, 0.998131, 0.997009, 0.995448, 0.993344, 0.990589, 0.987061, 0.982634, 0.977169, 0.970524, 0.962549, 0.953087, 0.941979, 0.929064, 0.914176, 0.897152, 0.87783, 0.856054, 0.831671, 0.80454, 0.774529, 0.741521, 0.705415, 0.666131, 0.62361, 0.577819, 0.528755, 0.476446, 0.420952, 0.362375, 0.300852, 0.236565, 0.169737, 0.10064, 0.029587, -0.043059, -0.11689, -0.191454, -0.266255, -0.340757, -0.414385, -0.486533, -0.556568, -0.623831, -0.687654, -0.747356, -0.802261, -0.851702, -0.895032, -0.931631, -0.960924, -0.982382, -0.995539, -1.0, -0.995449, -0.98166, -0.958505, -0.92596, -0.884113, -0.833164, -0.773433, -0.705357, -0.629489, -0.5465, -0.457168, -0.362375, -0.263095, -0.160389, -0.055383, 0.050734, 0.156738, 0.261377, 0.363394, 0.461542, 0.554606, 0.641419, 0.720878, 0.791967, 0.853768, 0.905477, 0.946419, 0.976054, 0.993994, 1.0, 0.993994, 0.976054, 0.946419, 0.905477, 0.853768, 0.791967, 0.720878, 0.641419, 0.554606, 0.461542, 0.363394, 0.261377, 0.156738, 0.050734, -0.055383, -0.160389, -0.263095, -0.362375, -0.457168, -0.5465, -0.629489, -0.705357, -0.773433, -0.833164, -0.884113, -0.92596, -0.958505, -0.98166, -0.995449, -1.0, -0.995539, -0.982382, -0.960924, -0.931631, -0.895032, -0.851702, -0.802261, -0.747356, -0.687654, -0.623831, -0.556568, -0.486533, -0.414385, -0.340757, -0.266255, -0.191454, -0.11689, -0.043059, 0.029587, 0.10064, 0.169737, 0.236565, 0.300852, 0.362375, 0.420952, 0.476446, 0.528755, 0.577819, 0.62361, 0.666131, 0.705415, 0.741521, 0.774529, 0.80454, 0.831671, 0.856054, 0.87783, 0.897152, 0.914176, 0.929064, 0.941979, 0.953087, 0.962549, 0.970524, 0.977169, 0.982634, 0.987061, 0.990589, 0.993344, 0.995448, 0.997009, 0.998131, 0.998903, 0.999408, 0.999714, 0.999883, 0.999963, 0.999993, 1.0, 1.0}, {-1.0, -0.999999, -0.999984, -0.999917, -0.999736, -0.999357, -0.998667, -0.997533, -0.995797, -0.993276, -0.989767, -0.985045, -0.978866, -0.970967, -0.961068, -0.948876, -0.934088, -0.916395, -0.895483, -0.871043, -0.842772, -0.810384, -0.773611, -0.732218, -0.686003, -0.634814, -0.578552, -0.517184, -0.450748, -0.37937, -0.303263, -0.222746, -0.138239, -0.050281, 0.040476, 0.133258, 0.227175, 0.321222, 0.414283, 0.505148, 0.592519, 0.675034, 0.751285, 0.819842, 0.879287, 0.928242, 0.965402, 0.989578, 0.99973, 0.995007, 0.974782, 0.938692, 0.886666, 0.818953, 0.736145, 0.639188, 0.529389, 0.408411, 0.27826, 0.141256, 0.0, -0.142677, -0.28377, -0.420167, -0.548725, -0.666352, -0.770093, -0.857214, -0.925292, -0.972294, -0.99665, -0.997323, -0.973854, -0.926402, -0.855763, -0.763371, -0.651275, -0.522105, -0.379009, -0.225578, -0.065752, 0.096287, 0.256231, 0.409773, 0.552732, 0.68118, 0.79156, 0.880796, 0.946392, 0.986503, 1.0, 0.986503, 0.946392, 0.880796, 0.79156, 0.68118, 0.552732, 0.409773, 0.256231, 0.096287, -0.065752, -0.225578, -0.379009, -0.522105, -0.651275, -0.763371, -0.855763, -0.926402, -0.973854, -0.997323, -0.99665, -0.972294, -0.925292, -0.857214, -0.770093, -0.666352, -0.548725, -0.420167, -0.28377, -0.142677, -0.0, 0.141256, 0.27826, 0.408411, 0.529389, 0.639188, 0.736145, 0.818953, 0.886666, 0.938692, 0.974782, 0.995007, 0.99973, 0.989578, 0.965402, 0.928242, 0.879287, 0.819842, 0.751285, 0.675034, 0.592519, 0.505148, 0.414283, 0.321222, 0.227175, 0.133258, 0.040476, -0.050281, -0.138239, -0.222746, -0.303263, -0.37937, -0.450748, -0.517184, -0.578552, -0.634814, -0.686003, -0.732218, -0.773611, -0.810384, -0.842772, -0.871043, -0.895483, -0.916395, -0.934088, -0.948876, -0.961068, -0.970967, -0.978866, -0.985045, -0.989767, -0.993276, -0.995797, -0.997533, -0.998667, -0.999357, -0.999736, -0.999917, -0.999984, -0.999999, -1.0}};
	float A_imag [LL][181] = {{0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0}, {0.0, 0.000478, 0.001914, 0.004305, 0.007653, 0.011954, 0.017209, 0.023415, 0.030569, 0.038669, 0.04771, 0.057688, 0.068597, 0.080432, 0.093183, 0.106843, 0.1214, 0.136842, 0.153155, 0.170324, 0.18833, 0.207152, 0.226769, 0.247153, 0.268278, 0.290111, 0.312618, 0.335761, 0.359499, 0.383787, 0.408576, 0.433815, 0.459446, 0.485409, 0.511642, 0.538074, 0.564635, 0.591248, 0.617833, 0.644307, 0.670582, 0.696568, 0.72217, 0.747292, 0.771834, 0.795693, 0.818766, 0.840947, 0.862129, 0.882204, 0.901064, 0.9186, 0.934707, 0.949279, 0.962212, 0.973404, 0.982759, 0.990183, 0.995586, 0.998884, 1.0, 0.998862, 0.995404, 0.989572, 0.981316, 0.970596, 0.957383, 0.941656, 0.923406, 0.902632, 0.879346, 0.853571, 0.825341, 0.7947, 0.761705, 0.726424, 0.688936, 0.649331, 0.60771, 0.564184, 0.518873, 0.471908, 0.423427, 0.373578, 0.322516, 0.270399, 0.217397, 0.163678, 0.10942, 0.054801, 0.0, -0.054801, -0.10942, -0.163678, -0.217397, -0.270399, -0.322516, -0.373578, -0.423427, -0.471908, -0.518873, -0.564184, -0.60771, -0.649331, -0.688936, -0.726424, -0.761705, -0.7947, -0.825341, -0.853571, -0.879346, -0.902632, -0.923406, -0.941656, -0.957383, -0.970596, -0.981316, -0.989572, -0.995404, -0.998862, -1.0, -0.998884, -0.995586, -0.990183, -0.982759, -0.973404, -0.962212, -0.949279, -0.934707, -0.9186, -0.901064, -0.882204, -0.862129, -0.840947, -0.818766, -0.795693, -0.771834, -0.747292, -0.72217, -0.696568, -0.670582, -0.644307, -0.617833, -0.591248, -0.564635, -0.538074, -0.511642, -0.485409, -0.459446, -0.433815, -0.408576, -0.383787, -0.359499, -0.335761, -0.312618, -0.290111, -0.268278, -0.247153, -0.226769, -0.207152, -0.18833, -0.170324, -0.153155, -0.136842, -0.1214, -0.106843, -0.093183, -0.080432, -0.068597, -0.057688, -0.04771, -0.038669, -0.030569, -0.023415, -0.017209, -0.011954, -0.007653, -0.004305, -0.001914, -0.000478, -0.0}, {-0.0, -0.000957, -0.003828, -0.008611, -0.015305, -0.023907, -0.034413, -0.046817, -0.061109, -0.077279, -0.095311, -0.115184, -0.136872, -0.160342, -0.185556, -0.212463, -0.241004, -0.271109, -0.302697, -0.33567, -0.36992, -0.405318, -0.441722, -0.478972, -0.516887, -0.555268, -0.593898, -0.632538, -0.67093, -0.708794, -0.745835, -0.781736, -0.816165, -0.848774, -0.879204, -0.907083, -0.932032, -0.953671, -0.971616, -0.985489, -0.994923, -0.999562, -0.999073, -0.993145, -0.981502, -0.963903, -0.940151, -0.910102, -0.873662, -0.830802, -0.781559, -0.726039, -0.664424, -0.596973, -0.524026, -0.446003, -0.363405, -0.276812, -0.186883, -0.094346, -0.0, 0.095299, 0.190642, 0.285076, 0.377621, 0.467273, 0.553025, 0.633878, 0.708852, 0.777009, 0.837459, 0.88938, 0.932032, 0.96477, 0.987054, 0.998465, 0.998712, 0.98764, 0.965237, 0.931636, 0.887118, 0.832113, 0.767191, 0.693062, 0.610563, 0.520653, 0.424394, 0.322942, 0.217527, 0.109437, 0.0, -0.109437, -0.217527, -0.322942, -0.424394, -0.520653, -0.610563, -0.693062, -0.767191, -0.832113, -0.887118, -0.931636, -0.965237, -0.98764, -0.998712, -0.998465, -0.987054, -0.96477, -0.932032, -0.88938, -0.837459, -0.777009, -0.708852, -0.633878, -0.553025, -0.467273, -0.377621, -0.285076, -0.190642, -0.095299, -0.0, 0.094346, 0.186883, 0.276812, 0.363405, 0.446003, 0.524026, 0.596973, 0.664424, 0.726039, 0.781559, 0.830802, 0.873662, 0.910102, 0.940151, 0.963903, 0.981502, 0.993145, 0.999073, 0.999562, 0.994923, 0.985489, 0.971616, 0.953671, 0.932032, 0.907083, 0.879204, 0.848774, 0.816165, 0.781736, 0.745835, 0.708794, 0.67093, 0.632538, 0.593898, 0.555268, 0.516887, 0.478972, 0.441722, 0.405318, 0.36992, 0.33567, 0.302697, 0.271109, 0.241004, 0.212463, 0.185556, 0.160342, 0.136872, 0.115184, 0.095311, 0.077279, 0.061109, 0.046817, 0.034413, 0.023907, 0.015305, 0.008611, 0.003828, 0.000957, 0.0}, {0.0, 0.001435, 0.005741, 0.012916, 0.022956, 0.035856, 0.051607, 0.070193, 0.091593, 0.115774, 0.142695, 0.172296, 0.204501, 0.239214, 0.276314, 0.31565, 0.357043, 0.400276, 0.445096, 0.491207, 0.538271, 0.5859, 0.633661, 0.681071, 0.727599, 0.772665, 0.815645, 0.855874, 0.892651, 0.925245, 0.952907, 0.974877, 0.990399, 0.998735, 0.999181, 0.991081, 0.973854, 0.947004, 0.910148, 0.863033, 0.805556, 0.737786, 0.659978, 0.57259, 0.476292, 0.371978, 0.260766, 0.143995, 0.02322, -0.099808, -0.22316, -0.344757, -0.462411, -0.573861, -0.676824, -0.769051, -0.848379, -0.912798, -0.960506, -0.989973, -1.0, -0.989769, -0.958892, -0.907447, -0.836003, -0.745637, -0.637932, -0.51496, -0.379255, -0.233763, -0.08178, 0.07312, 0.227175, 0.376536, 0.517367, 0.64596, 0.758842, 0.852881, 0.925393, 0.974225, 0.997836, 0.995354, 0.966616, 0.912188, 0.833359, 0.732116, 0.611092, 0.473495, 0.323021, 0.163744, 0.0, -0.163744, -0.323021, -0.473495, -0.611092, -0.732116, -0.833359, -0.912188, -0.966616, -0.995354, -0.997836, -0.974225, -0.925393, -0.852881, -0.758842, -0.64596, -0.517367, -0.376536, -0.227175, -0.07312, 0.08178, 0.233763, 0.379255, 0.51496, 0.637932, 0.745637, 0.836003, 0.907447, 0.958892, 0.989769, 1.0, 0.989973, 0.960506, 0.912798, 0.848379, 0.769051, 0.676824, 0.573861, 0.462411, 0.344757, 0.22316, 0.099808, -0.02322, -0.143995, -0.260766, -0.371978, -0.476292, -0.57259, -0.659978, -0.737786, -0.805556, -0.863033, -0.910148, -0.947004, -0.973854, -0.991081, -0.999181, -0.998735, -0.990399, -0.974877, -0.952907, -0.925245, -0.892651, -0.855874, -0.815645, -0.772665, -0.727599, -0.681071, -0.633661, -0.5859, -0.538271, -0.491207, -0.445096, -0.400276, -0.357043, -0.31565, -0.276314, -0.239214, -0.204501, -0.172296, -0.142695, -0.115774, -0.091593, -0.070193, -0.051607, -0.035856, -0.022956, -0.012916, -0.005741, -0.001435, -0.0}};

	xil_printf("\r\nData Initialization done\r\n");

	xil_printf("\r\nFor ULA, enter 1 or 2 DoAs to be computed, 0 to exit the program\r");
	xil_printf("\r\nExpected answer for #DoA=1: 80\r");
	xil_printf("\r\nExpected answer for #DoA=2: 121 29\r");

	int choice, dma_size_out;

	bool exit = 0;

//main loop
	while (!exit)
	{
		xil_printf("\r\nEnter the value of #DOAs to be computed\r\n");
		scanf("%d", &choice);
		xil_printf("Choice entered: %d\r\n", choice);
		switch (choice)
		{
			case 0:
				exit = 1;
				break;

			case 1:
				dma_size_out = 1*sizeof(int);
				partialReconfigure("config1.bin", &DcfgInstance, bitStreamBuffer);

				Setup_HW_Accelerator(dma_size1, dma_size2, dma_size_out, X_real, X_imag, A_real, A_imag, res_hw1);
				Start_HW_Accelerator();
				Run_HW_Accelerator(dma_size1, dma_size2, dma_size_out, X_real, X_imag, A_real, A_imag, res_hw1);

				xil_printf("\rResult: ");
				for(j = 0 ; j < 1 ; j++)
				{
					xil_printf("%d ", res_hw1[j]);

				}
				xil_printf("\r\n");
				break;

			case 2:
				dma_size_out = 2*sizeof(int);
				partialReconfigure("config2.bin", &DcfgInstance, bitStreamBuffer);

				Setup_HW_Accelerator(dma_size1, dma_size2, dma_size_out, X_real, X_imag, A_real, A_imag, res_hw2);
				Start_HW_Accelerator();
				Run_HW_Accelerator(dma_size1, dma_size2, dma_size_out, X_real, X_imag, A_real, A_imag, res_hw2);

				xil_printf("\rResult: ");
				for(j = 0 ; j < 2 ; j++)
				{
					xil_printf("%d ", res_hw2[j]);

				}
				xil_printf("\r\n");
				break;

			default:
				xil_printf("Wrong choice \r\n");
				break;
		}
	}

	xil_printf("Exiting the program\r\n");

//comment till here
    cleanup_platform();
    return 0;
}

